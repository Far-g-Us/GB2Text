name: Issue Response System
on:
  issues:
    types: [opened]

jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Classify issue
        id: labeler
        uses: actions/github-script@v6
        with:
          script: |
            const labelsMap = {
              'bug': ['error', 'crash', 'fail'],
              'game-support': ['pokemon', 'zelda', 'game'],
              'documentation': ['doc', 'readme', 'help']
            };
            
            const title = context.payload.issue.title.toLowerCase();
            const body = context.payload.issue.body.toLowerCase();
            
            let labelsToAdd = [];
            
            for (const [label, keywords] of Object.entries(labelsMap)) {
              if (keywords.some(kw => title.includes(kw) || body.includes(kw))) {
                labelsToAdd.push(label);
              }
            }
            
            return labelsToAdd;
        outputs:
          labels: ${{ steps.labeler.outputs.result }}

      - name: Add labels
        uses: actions-ecosystem/action-add-labels@v1
        with:
          labels: ${{ steps.labeler.outputs.labels }}
          github_token: ${{ secrets.GITHUB_TOKEN }}

      - name: Send welcome response
        uses: actions/github-script@v6
        if: ${{ always() }}
        with:
          script: |
            const type = ${{ steps.labeler.outputs.labels }}.includes('bug') 
              ? '–±–∞–≥' 
              : ${{ steps.labeler.outputs.labels }}.includes('enhancement') 
                ? '–∑–∞–ø—Ä–æ—Å —Ñ—É–Ω–∫—Ü–∏–∏' 
                : '–≤–æ–ø—Ä–æ—Å';
                
            const response = {
              bug: `üöß –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ! –ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –µ—ë –≤ —Ç–µ—á–µ–Ω–∏–µ 48 —á–∞—Å–æ–≤. –ü–æ–∫–∞ –º–æ–∂–µ—Ç–µ: 
                    1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ö–æ–∂–∏–µ issues
                    2. –£–∫–∞–∑–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ ROM-—Ñ–∞–π–ª–∞`,
              enhancement: `üåü –û—Ç–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ! –î–æ–±–∞–≤–∏–ª–∏ –≤ –±—ç–∫–ª–æ–≥. –û–±—Å—É–¥–∏–º –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏.`,
              default: `üôè –°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –û—Ç–≤–µ—Ç–∏–º –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.`
            };
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: response[type] || response.default
            });