name: Issue Triage System
on:
  issues:
    types: [opened]

jobs:
  classify_and_respond:
    runs-on: ubuntu-latest
    steps:
      # –®–∞–≥ 1: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è issue
      - name: Classify issue type
        id: classifier
        uses: actions/github-script@v6
        with:
          script: |
            const { title, body } = context.payload.issue;
            const content = (title + ' ' + body).toLowerCase();
            
            const labelsMap = {
              'bug': ['error', 'crash', 'fail', '–æ—à–∏–±–∫–∞', '–±–∞–≥', '–ø—Ä–æ–±–ª–µ–º–∞'],
              'enhancement': ['feature', '—É–ª—É—á—à–µ–Ω–∏–µ', '–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ', '—Ñ—É–Ω–∫—Ü–∏—è'],
              'documentation': ['doc', 'readme', 'help', '–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è'],
              'game-support': ['game', '–∏–≥—Ä–∞', 'rom', '–∫–∞—Ä—Ç—Ä–∏–¥–∂'],
              'text-extraction': ['text', '—Ç–µ–∫—Å—Ç', 'string', '–¥–∏–∞–ª–æ–≥']
            };
            
            const detectedLabels = [];
            for (const [label, keywords] of Object.entries(labelsMap)) {
              if (keywords.some(kw => content.includes(kw))) {
                detectedLabels.push(label);
              }
            }
            
            // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –æ—Ç–≤–µ—Ç–∞
            let responseType = 'general';
            if (detectedLabels.includes('bug')) responseType = 'bug';
            else if (detectedLabels.includes('enhancement')) responseType = 'enhancement';
            
            return { 
              labels: JSON.stringify(detectedLabels),
              responseType: responseType
            };
        outputs:
          labels: ${{ steps.classifier.outputs.labels }}
          responseType: ${{ steps.classifier.outputs.responseType }}

      # –®–∞–≥ 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–∫
      - name: Apply labels
        uses: actions-ecosystem/action-add-labels@v1
        with:
          labels: ${{ steps.classifier.outputs.labels }}
          github_token: ${{ secrets.GITHUB_TOKEN }}

      # –®–∞–≥ 3: –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
      - name: Send response
        uses: actions/github-script@v6
        with:
          script: |
            const responseTypes = {
              bug: `### üêõ –°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç—á–µ—Ç –æ–± –æ—à–∏–±–∫–µ!
–î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
1. **–•—ç—à SHA-256** ROM-—Ñ–∞–π–ª–∞:
   \`\`\`bash
   sha256sum –≤–∞—à–∞_–∏–≥—Ä–∞.gb
   \`\`\`
2. **–ê–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏** –≥–¥–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 0x15A3)
3. **–î–∞–º–ø –ø–∞–º—è—Ç–∏** –≤–æ–∫—Ä—É–≥ –∞–¥—Ä–µ—Å–∞:
   \`\`\`bash
   hexdump -C -s 0x15A0 -n 32 –≤–∞—à–∞_–∏–≥—Ä–∞.gb
   \`\`\`
4. **–í–µ—Ä—Å–∏—è –∏–≥—Ä—ã** (USA/EUR/JPN/Other)

‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –ø—Ä–∏–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ —Ñ–∞–π–ª—ã ROM - —ç—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –∞–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞.`,
              
              enhancement: `### üåü –°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏!
–ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞—à–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π. –ü–æ–∫–∞ –º–æ–∂–µ—Ç–µ:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ö–æ–∂–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
2. –£—Ç–æ—á–Ω–∏—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
3. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è`,
              
              general: `### üôè –°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ!
–ú—ã –æ—Ç–≤–µ—Ç–∏–º –Ω–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π.`
            };
            
            const response = responseTypes[${{ steps.classifier.outputs.responseType }}] || responseTypes.general;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: response
            });

      # –®–∞–≥ 4: –î–ª—è –∏–≥—Ä–æ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º - –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
      - name: Suggest homebrew alternatives
        if: contains(steps.classifier.outputs.labels, 'game-support')
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              body: `### üéÆ –õ–µ–≥–∞–ª—å–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å –∏–≥—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ homebrew ROM:
1. [Homebrew Collection](https://github.com/untoxa/homebrew-gb-games)
2. [GB Studio Games](https://itch.io/games/tag-gb-studio)
3. [PD Roms](https://www.pdroms.de/files/gameboy/)`
            });